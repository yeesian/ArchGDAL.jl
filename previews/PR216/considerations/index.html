<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Design Considerations · ArchGDAL.jl</title><link rel="canonical" href="https://yeesian.com/ArchGDAL.jl/considerations/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ArchGDAL.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">ArchGDAL.jl documentation</a></li><li><a class="tocitem" href="../quickstart/">ArchGDAL Quickstart Guide</a></li><li><a class="tocitem" href="../datasets/">GDAL Datasets</a></li><li><a class="tocitem" href="../features/">Feature Data</a></li><li><a class="tocitem" href="../rasters/">Raster Data</a></li><li><a class="tocitem" href="../images/">Working with Images</a></li><li><a class="tocitem" href="../tables/">Tables Interface</a></li><li><a class="tocitem" href="../geometries/">Geometric Operations</a></li><li><a class="tocitem" href="../projections/">Spatial Projections</a></li><li><a class="tocitem" href="../memory/">Interactive versus Scoped Objects</a></li><li class="is-active"><a class="tocitem" href>Design Considerations</a><ul class="internal"><li><a class="tocitem" href="#Code-Defensiveness"><span>Code Defensiveness</span></a></li><li><a class="tocitem" href="#GDAL-Enum-Values"><span>GDAL Enum Values</span></a></li><li><a class="tocitem" href="#Colors"><span>Colors</span></a></li><li><a class="tocitem" href="#Images"><span>Images</span></a></li><li><a class="tocitem" href="#Tables.jl-Interface"><span>Tables.jl Interface</span></a></li></ul></li><li><a class="tocitem" href="../reference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Design Considerations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Design Considerations</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/yeesian/ArchGDAL.jl/blob/master/docs/src/considerations.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Design-Considerations"><a class="docs-heading-anchor" href="#Design-Considerations">Design Considerations</a><a id="Design-Considerations-1"></a><a class="docs-heading-anchor-permalink" href="#Design-Considerations" title="Permalink"></a></h1><h2 id="Code-Defensiveness"><a class="docs-heading-anchor" href="#Code-Defensiveness">Code Defensiveness</a><a id="Code-Defensiveness-1"></a><a class="docs-heading-anchor-permalink" href="#Code-Defensiveness" title="Permalink"></a></h2><p>Although GDAL provides a unified data model for different data formats, there are still significant differences between their implementations such that each driver is effectively its own application. This has the following implications:</p><ul><li>Not all configuration options works for all drivers.</li><li>Not all capabilities are available for all drivers.</li><li>Performance characteristics may vary significantly depending on the driver.</li></ul><p><code>ArchGDAL.jl</code> provides mechanisms for setting GDAL&#39;s configuration options, and does not maintain its own list of sanctioned options for each driver. Although work is underway to make this an easier experience for the user, it remains the responsibility of the user to check that a particular configuration exists and works for their choice of drivers.</p><p>Here&#39;s a collection of references for developers who are interested:</p><ul><li><a href="https://trac.osgeo.org/gdal/wiki/ConfigOptions">https://trac.osgeo.org/gdal/wiki/ConfigOptions</a></li><li><a href="https://github.com/mapbox/rasterio/pull/665">https://github.com/mapbox/rasterio/pull/665</a></li><li><a href="https://github.com/mapbox/rasterio/issues/875">https://github.com/mapbox/rasterio/issues/875</a></li><li><a href="https://rasterio.readthedocs.io/en/latest/topics/configuration.html">https://rasterio.readthedocs.io/en/latest/topics/configuration.html</a></li></ul><h2 id="GDAL-Enum-Values"><a class="docs-heading-anchor" href="#GDAL-Enum-Values">GDAL Enum Values</a><a id="GDAL-Enum-Values-1"></a><a class="docs-heading-anchor-permalink" href="#GDAL-Enum-Values" title="Permalink"></a></h2><p><a href="https://github.com/JuliaGeo/GDAL.jl">GDAL.jl</a> uses <a href="https://github.com/JuliaInterop/CEnum.jl">CEnum.jl</a>, which is a C-compatible enum, this is the default in <a href="https://github.com/JuliaInterop/Clang.jl">Clang.jl</a>. This is useful when the underlying values are of interest, for example the following snippets from <a href="https://github.com/yeesian/ArchGDAL.jl/blob/master/src/types.jl"><code>src/types.jl</code></a>:</p><pre><code class="language-julia">import Base.|

for T in (GDALOpenFlag, FieldValidation)
    eval(quote
        |(x::$T, y::UInt8) = UInt8(x) | y
        |(x::UInt8, y::$T) = x | UInt8(y)
        |(x::$T, y::$T) = UInt8(x) | UInt8(y)
    end)
end</code></pre><p>and</p><pre><code class="language-julia">function basetype(gt::OGRwkbGeometryType)::OGRwkbGeometryType
    wkbGeomType = convert(GDAL.OGRwkbGeometryType, gt)
    wkbGeomType &amp;= (~0x80000000) # Remove 2.5D flag.
    wkbGeomType %= 1000 # Normalize Z, M, and ZM types.
    return GDAL.OGRwkbGeometryType(wkbGeomType)
end</code></pre><p>However, the use of CEnum.jl allows for multiple enums to have the same underlying value, resulting in unintuitive behavior if they are used as keys in a dictionary. For example, in the following code:</p><pre><code class="language-julia">julia&gt; Dict(GDAL.GCI_YCbCr_CrBand =&gt; &quot;a&quot;, GDAL.GCI_Max =&gt; &quot;b&quot;)
Dict{GDAL.GDALColorInterp, String} with 1 entry:
  GCI_YCbCr_CrBand =&gt; &quot;b&quot;</code></pre><p>the entry for <code>GDAL.GCI_YCbCr_CrBand =&gt; &quot;a&quot;</code> got overwritten by <code>GDAL.GCI_Max =&gt; &quot;b&quot;</code> because both <code>GDAL.GCI_YCbCr_CrBand</code> and <code>GDAL.GCI_Max</code> corresponded to the same value.</p><p>To avoid such forms of behavior, this package uses <a href="https://docs.julialang.org/en/v1/base/base/#Base.Enums.Enum"><code>Base.Enums</code></a> instead, so the above example would result in the following behavior:</p><pre><code class="language-julia">julia&gt; Dict(ArchGDAL.GCI_YCbCr_CrBand =&gt; &quot;a&quot;, ArchGDAL.GCI_Max =&gt; &quot;b&quot;)
Dict{ArchGDAL.GDALColorInterp, String} with 2 entries:
  GCI_YCbCr_CrBand =&gt; &quot;a&quot;
  GCI_Max          =&gt; &quot;b&quot;</code></pre><p>To maintain parity with GDAL behavior, ArchGDAL.jl provides conversion methods to map from the enums in ArchGDAL to the corresponding cenums from GDAL.jl when calling the corresponding GDAL functions.</p><h2 id="Colors"><a class="docs-heading-anchor" href="#Colors">Colors</a><a id="Colors-1"></a><a class="docs-heading-anchor-permalink" href="#Colors" title="Permalink"></a></h2><p>Rather than encouraging <a href="https://gdal.org/python/osgeo.gdal.ColorTable-class.html">operations on colortables</a> (with very limited functionality from GDAL), users are better served by arrays of <a href="https://github.com/JuliaGraphics/ColorTypes.jl">ColorTypes</a> using <a href="https://github.com/JuliaGraphics/Colors.jl">Colors.jl</a>, <a href="http://juliagraphics.github.io/Colors.jl/stable/colormapsandcolorscales/#Generating-a-range-of-colors">for example</a></p><pre><code class="language-julia">range(startcolor, stop=endcolor, length=15)</code></pre><p>instead of</p><pre><code class="language-julia">createcolorramp!(colortable, startindex, startcolor, startindex+15, endcolor)</code></pre><h2 id="Images"><a class="docs-heading-anchor" href="#Images">Images</a><a id="Images-1"></a><a class="docs-heading-anchor-permalink" href="#Images" title="Permalink"></a></h2><p>To differentiate 2d arrays of colors from 3d arrays with band as the third dimension:</p><ul><li>For 2D arrays (a single rasterband), if they have a color interpretation, we use the color interpretation. If they don&#39;t have a color interpretation, ArchGDAL.jl defaults to &quot;Grey&quot;.</li><li>For &gt;2D arrays (multiple rasterbands), if they have a palette interpretation (or combination of color interpretations) that resolves to a valid colortype, ArchGDAL.jl uses the palette interpretation. If they don&#39;t have a palette interpretation, we throw an error.</li></ul><p>In general, <code>read()</code> will return <code>Array{UInt8}</code>, and <code>imread()</code> will return <code>Array{&lt;:Colorant}</code>.</p><h2 id="Tables.jl-Interface"><a class="docs-heading-anchor" href="#Tables.jl-Interface">Tables.jl Interface</a><a id="Tables.jl-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Tables.jl-Interface" title="Permalink"></a></h2><p>The interface is implemented in <a href="https://github.com/yeesian/ArchGDAL.jl/blob/master/src/tables.jl"><code>src/tables.jl</code></a>, and is only for feature and geometries in OGR (and not for images and rasters). The current API from GDAL makes it row-based in the conventions of Tables.jl. Therefore,</p><ul><li><code>ArchGDAL.Feature</code> meets the criteria for an <a href="https://tables.juliadata.org/dev/#Tables.AbstractRow-1"><code>AbstractRow</code></a> based on https://github.com/yeesian/ArchGDAL.jl/blob/a665f3407930b8221269f8949c246db022c3a85c/src/tables.jl#L31-L58.</li><li><code>ArchGDAL.FeatureLayer</code> meets the criteria for an <code>AbstractRow</code>-iterator based on the previous bullet and meeting the criteria for <a href="https://docs.julialang.org/en/v1/manual/interfaces/#man-interface-iteration"><code>Iteration</code></a> in <a href="https://github.com/yeesian/ArchGDAL.jl/blob/a665f3407930b8221269f8949c246db022c3a85c/src/base/iterators.jl#L1-L18"><code>base/iterators.jl</code></a>.</li><li><code>ArchGDAL.AbstractDataset</code> might contain multiple layers, and might correspond to multiple tables. The way to construct tables would be to get the layers before forming the corresponding tables.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../memory/">« Interactive versus Scoped Objects</a><a class="docs-footer-nextpage" href="../reference/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 5 July 2021 19:20">Monday 5 July 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
