<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Raster Data · ArchGDAL.jl</title><link rel="canonical" href="https://yeesian.com/ArchGDAL.jl/rasters/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ArchGDAL.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">ArchGDAL.jl documentation</a></li><li><a class="tocitem" href="../datasets/">GDAL Datasets</a></li><li><a class="tocitem" href="../features/">Feature Data</a></li><li class="is-active"><a class="tocitem" href>Raster Data</a><ul class="internal"><li><a class="tocitem" href="#Raster-Bands"><span>Raster Bands</span></a></li><li><a class="tocitem" href="#Raster-I/O"><span>Raster I/O</span></a></li><li><a class="tocitem" href="#Windowed-Reads-and-Writes"><span>Windowed Reads and Writes</span></a></li><li class="toplevel"><a class="tocitem" href="#Using-the-DiskArray-interface"><span>Using the DiskArray interface</span></a></li><li><a class="tocitem" href="#Raster-bands-as-2D-DiskArrays"><span>Raster bands as 2D DiskArrays</span></a></li><li><a class="tocitem" href="#The-RasterDataset-type"><span>The RasterDataset type</span></a></li></ul></li><li><a class="tocitem" href="../geometries/">Geometric Operations</a></li><li><a class="tocitem" href="../projections/">Spatial Projections</a></li><li><a class="tocitem" href="../memory/">Interactive versus Scoped Objects</a></li><li><a class="tocitem" href="../considerations/">Design Considerations</a></li><li><a class="tocitem" href="../reference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Raster Data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Raster Data</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/yeesian/ArchGDAL.jl/blob/master/docs/src/rasters.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Raster-Data"><a class="docs-heading-anchor" href="#Raster-Data">Raster Data</a><a id="Raster-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Raster-Data" title="Permalink"></a></h1><p>In this section, we revisit the <a href="https://github.com/yeesian/ArchGDALDatasets/blob/307f8f0e584a39a050c042849004e6a2bd674f99/gdalworkshop/world.tif"><code>gdalworkshop/world.tif</code></a> dataset.</p><pre><code class="language-julia">dataset = AG.read(&quot;gdalworkshop/world.tif&quot;)</code></pre><pre class="documenter-example-output">GDAL Dataset (Driver: GTiff/GeoTIFF)
File(s): 

Dataset (width x height): 2048 x 1024 (pixels)
Number of raster bands: 3
  [GA_ReadOnly] Band 1 (Red): 2048 x 1024 (UInt8)
  [GA_ReadOnly] Band 2 (Green): 2048 x 1024 (UInt8)
  [GA_ReadOnly] Band 3 (Blue): 2048 x 1024 (UInt8)
</pre><p>A description of the display is available in <a href="../datasets/#Raster-Datasets">Raster Datasets</a>.</p><h2 id="Raster-Bands"><a class="docs-heading-anchor" href="#Raster-Bands">Raster Bands</a><a id="Raster-Bands-1"></a><a class="docs-heading-anchor-permalink" href="#Raster-Bands" title="Permalink"></a></h2><p>We can examine an individual raster band</p><pre><code class="language-julia">band = ArchGDAL.getband(dataset, 1)</code></pre><pre class="documenter-example-output">[GA_ReadOnly] Band 1 (Red): 2048 x 1024 (UInt8)
    blocksize: 256×256, nodata: -1.0e10, units: 1.0px + 0.0
    overviews: (0) 1024x512 (1) 512x256 (2) 256x128 
               (3) 128x64 (4) 64x32 (5) 32x16 
               (6) 16x8 </pre><p>You can programmatically retrieve the information in the header using</p><ul><li><a href="../reference/#ArchGDAL.accessflag-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.accessflag(band)</code></a>: the access flag for this band. (<code>GA_ReadOnly</code>)</li><li><code>colorinterp =</code><a href="../reference/#ArchGDAL.getcolorinterp-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.getcolorinterp(band)</code></a>: color interpretation of the values in the band (<code>GCI_RedBand</code>)</li><li><a href="../reference/#ArchGDAL.getname-Tuple{GDAL.GDALAsyncStatusType}"><code>ArchGDAL.getname(colorinterp)</code></a>: name (string) corresponding to color interpretation (<code>&quot;Red&quot;</code>)</li><li><a href="../reference/#ArchGDAL.width-Tuple{ArchGDAL.AbstractDataset}"><code>ArchGDAL.width(band)</code></a>: width (pixels) of the band (<code>2048</code>)</li><li><a href="../reference/#ArchGDAL.height-Tuple{ArchGDAL.AbstractDataset}"><code>ArchGDAL.height(band)</code></a>: height (pixels) of the band (<code>1024</code>)</li><li><a href="../reference/#ArchGDAL.indexof-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.indexof(band)</code></a>: the index of the band (1+) within its dataset, or 0 if unknown. (<code>1</code>)</li><li><a href="../reference/#ArchGDAL.pixeltype-Union{Tuple{ArchGDAL.AbstractRasterBand{T}}, Tuple{T}} where T"><code>ArchGDAL.pixeltype(band)</code></a>: pixel data type for this band. (<code>UInt8</code>)</li></ul><p>You can get additional attribute information using</p><ul><li><a href="../reference/#ArchGDAL.getscale-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.getscale(band)</code></a>: the scale in <code>units = (px * scale) + offset</code> (<code>1.0</code>)</li><li><a href="../reference/#ArchGDAL.getoffset-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.getoffset(band)</code></a>: the offset in <code>units = (px * scale) + offset</code> (<code>0.0</code>)</li><li><a href="../reference/#ArchGDAL.getunittype-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.getunittype(band)</code></a>: name for the units, e.g. &quot;m&quot; (meters) or &quot;ft&quot; (feet). (<code>&quot;&quot;</code>)</li><li><a href="../reference/#ArchGDAL.getnodatavalue-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.getnodatavalue(band)</code></a>: a special marker value used to mark pixels that are not valid data. (<code>-1.0e10</code>)</li><li><code>(x,y) =</code><a href="../reference/#ArchGDAL.blocksize-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.blocksize(band)</code></a>: the &quot;natural&quot; block size of this band (<code>(256,256)</code>)</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>GDAL contains a concept of the natural block size of rasters so that applications can organized data access efficiently for some file formats. The natural block size is the block size that is most efficient for accessing the format. For many formats this is simple a whole scanline. However, for tiled images this will typically be the tile size.</p></div></div><p>Finally, you can obtain overviews:</p><ul><li><a href="../reference/#ArchGDAL.noverview-Tuple{ArchGDAL.AbstractRasterBand}"><code>ArchGDAL.noverview(band)</code></a>: the number of overview layers available, zero if none. (<code>7</code>)</li><li><a href="../reference/#ArchGDAL.getoverview-Tuple{ArchGDAL.IRasterBand,Integer}"><code>ArchGDAL.getoverview(band, i)</code></a>: returns the <code>i</code>-th overview in the raster band. Each overview is itself a raster band, e.g.</li></ul><pre><code class="language-julia">ArchGDAL.getoverview(band, 2)</code></pre><pre class="documenter-example-output">[GA_ReadOnly] Band 1 (Red): 256 x 128 (UInt8)
    blocksize: 128×128, nodata: -1.0e10, units: 1.0px + 0.0
    overviews: </pre><h2 id="Raster-I/O"><a class="docs-heading-anchor" href="#Raster-I/O">Raster I/O</a><a id="Raster-I/O-1"></a><a class="docs-heading-anchor-permalink" href="#Raster-I/O" title="Permalink"></a></h2><h3 id="Reading-Raster-Values"><a class="docs-heading-anchor" href="#Reading-Raster-Values">Reading Raster Values</a><a id="Reading-Raster-Values-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-Raster-Values" title="Permalink"></a></h3><p>The general operative method for reading in raster values from a <code>dataset</code> or <code>band</code> is to use <code>ArchGDAL.read()</code>.</p><ul><li><code>ArchGDAL.read(dataset)</code>: reads the entire dataset as a single multidimensional array.</li><li><code>ArchGDAL.read(dataset, indices)</code>: reads the raster bands at the <code>indices</code> (in that order) into a multidimensional array.</li><li><code>ArchGDAL.read(dataset, i)</code>: reads the <code>i</code>-th raster band into an array.</li><li><code>ArchGDAL.read(band)</code>: reads the raster band into an array.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The array returned by <code>read</code> has <code>(cols, rows, bands)</code> dimensions. </p><p>To convert to a format used by the Images.jl ecosystem, you can either create a view using <code>PermutedDimsArray(A, (3,2,1))</code> or create a permuted copy using <code>permutedims(A, (3,2,1))</code>. The resulting arrays will have <code>(bands, rows, cols)</code> dimensions.</p></div></div><p>You can also specify the subset of rows and columns (provided as <code>UnitRange</code>s like <code>2:9</code>) to read:</p><ul><li><code>ArchGDAL.read(dataset, indices, rows, cols)</code></li><li><code>ArchGDAL.read(dataset, i, rows, cols)</code></li><li><code>ArchGDAL.read(band, rows, cols)</code></li></ul><p>On other occasions, it might be easier to first specify a position <code>(xoffset,yoffset)</code> to read from, and the size <code>(xsize, ysize)</code> of the window to read:</p><ul><li><code>ArchGDAL.read(dataset, indices, xoffset, yoffset, xsize, ysize)</code></li><li><code>ArchGDAL.read(dataset, i, xoffset, yoffset, xsize, ysize)</code></li><li><code>ArchGDAL.read(band, xoffset, yoffset, xsize, ysize)</code></li></ul><p>You might have an existing buffer that you wish to read the values into. In such cases, the general API for doing so is to write <code>ArchGDAL.read!(source, buffer, args...)</code> instead of <code>ArchGDAL.read(source, args...)</code>.</p><h3 id="Writing-Raster-Values"><a class="docs-heading-anchor" href="#Writing-Raster-Values">Writing Raster Values</a><a id="Writing-Raster-Values-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-Raster-Values" title="Permalink"></a></h3><p>For writing values from a <code>buffer</code> to a raster <code>dataset</code> or <code>band</code>, the following methods are available:</p><ul><li><code>ArchGDAL.write!(band, buffer)</code></li><li><code>ArchGDAL.write!(band, buffer, rows, cols)</code></li><li><code>ArchGDAL.write!(band, buffer, xoffset, yoffset, xsize, ysize)</code></li><li><code>ArchGDAL.write!(dataset, buffer, i)</code></li><li><code>ArchGDAL.write!(dataset, buffer, i, rows, cols)</code></li><li><code>ArchGDAL.write!(dataset, buffer, i, xoffset, yoffset, xsize, ysize)</code></li><li><code>ArchGDAL.write!(dataset, buffer, indices)</code></li><li><code>ArchGDAL.write!(dataset, buffer, indices, rows, cols)</code></li><li><code>ArchGDAL.write!(dataset, buffer, indices, xoffset, yoffset, xsize, ysize)</code></li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>ArchGDAL expects the dimensions of the buffer to be <code>(cols, rows, bands)</code> or <code>(cols, rows)</code>.</p></div></div><h2 id="Windowed-Reads-and-Writes"><a class="docs-heading-anchor" href="#Windowed-Reads-and-Writes">Windowed Reads and Writes</a><a id="Windowed-Reads-and-Writes-1"></a><a class="docs-heading-anchor-permalink" href="#Windowed-Reads-and-Writes" title="Permalink"></a></h2><p>Following the description in <a href="https://rasterio.readthedocs.io/en/latest/topics/windowed-rw.html">mapbox/rasterio&#39;s documentation</a>, a window is a view onto a rectangular subset of a raster dataset. This is useful when you want to work on rasters that are larger than your computers RAM or process chunks of large rasters in parallel.</p><p>For that purpose, we have a method called <code>ArchGDAL.windows(band)</code> which iterates over the windows of a raster band, returning the indices corresponding to the rasterblocks within that raster band for efficiency:</p><pre><code class="language-julia">using Base.Iterators: take  # to prevent showing all blocks
windows = ArchGDAL.windows(band)

for (cols, rows) in take(windows, 5)
    @info &quot;Window&quot; cols rows
end</code></pre><pre class="documenter-example-output">┌ Info: Window
│   cols = 1:256
└   rows = 1:256
┌ Info: Window
│   cols = 1:256
└   rows = 257:512
┌ Info: Window
│   cols = 1:256
└   rows = 513:768
┌ Info: Window
│   cols = 1:256
└   rows = 769:1024
┌ Info: Window
│   cols = 257:512
└   rows = 1:256</pre><p>Alternatively, we have another method called <code>ArchGDAL.blocks(band)</code> which iterates over the windows of a raster band, returning the <code>offset</code> and <code>size</code> corresponding to the rasterblocks within that raster band for efficiency:</p><pre><code class="language-julia">blocks = ArchGDAL.blocks(band)
for (xyoffset, xysize) in take(blocks, 5)
    @info &quot;Window offset&quot; xyoffset xysize
end</code></pre><pre class="documenter-example-output">┌ Info: Window offset
│   xyoffset = (0, 0)
└   xysize = (256, 256)
┌ Info: Window offset
│   xyoffset = (1, 0)
└   xysize = (256, 256)
┌ Info: Window offset
│   xyoffset = (2, 0)
└   xysize = (256, 256)
┌ Info: Window offset
│   xyoffset = (3, 0)
└   xysize = (256, 256)
┌ Info: Window offset
│   xyoffset = (0, 1)
└   xysize = (256, 256)</pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>These methods are often used for reading/writing a block of image data efficiently, as it accesses &quot;natural&quot; blocks from the raster band without resampling, or data type conversion.</p></div></div><h1 id="Using-the-DiskArray-interface"><a class="docs-heading-anchor" href="#Using-the-DiskArray-interface">Using the DiskArray interface</a><a id="Using-the-DiskArray-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-DiskArray-interface" title="Permalink"></a></h1><h2 id="Raster-bands-as-2D-DiskArrays"><a class="docs-heading-anchor" href="#Raster-bands-as-2D-DiskArrays">Raster bands as 2D DiskArrays</a><a id="Raster-bands-as-2D-DiskArrays-1"></a><a class="docs-heading-anchor-permalink" href="#Raster-bands-as-2D-DiskArrays" title="Permalink"></a></h2><p>As of ArchGDAL version 0.5.0 and higher a <code>RasterBand</code> is a subtype of <code>AbstractDiskArray</code> from the <a href="https://github.com/meggart/DiskArrays.jl">DiskArrays.jl package</a>. This means that a <code>RasterBand</code> is also an <code>AbstractArray</code> and can therefore be treated like any Julia array. This means that square bracket indexing works in addition to the <code>read</code> methods described above.  </p><pre><code class="language-julia">band[1000:1010,300:310]</code></pre><pre class="documenter-example-output">11×11 Array{UInt8,2}:
 0x87  0x8a  0x7b  0x5f  0x32  0x08  0x11  0x11  0x0d  0x0e  0x09
 0x8c  0x96  0x70  0x70  0x32  0x10  0x0e  0x0e  0x0a  0x11  0x0a
 0x88  0xa5  0x87  0x6f  0x25  0x10  0x0f  0x10  0x0a  0x10  0x07
 0x80  0x9c  0x87  0x60  0x1c  0x16  0x10  0x0b  0x03  0x0c  0x0f
 0x7a  0x7e  0x6e  0x57  0x2d  0x12  0x0f  0x0c  0x05  0x0e  0x0f
 0x80  0x6e  0x5e  0x5b  0x3d  0x0a  0x0e  0x13  0x0f  0x13  0x07
 0x8f  0x70  0x58  0x5a  0x26  0x0f  0x10  0x11  0x0a  0x11  0x0f
 0x96  0x73  0x56  0x63  0x1b  0x13  0x10  0x0d  0x03  0x0e  0x18
 0x91  0x71  0x5a  0x80  0x35  0x0b  0x0e  0x13  0x0b  0x10  0x0f
 0x87  0x69  0x67  0x84  0x61  0x00  0x0f  0x0c  0x04  0x0c  0x11
 0x88  0x6a  0x72  0x70  0x1a  0x0e  0x0f  0x0c  0x09  0x06  0x06</pre><p>Also, windowed reading of the data can alternatively be done through the DiskArrays interface:</p><pre><code class="language-julia">using DiskArrays: eachchunk
# take only the first 3 chunks to decrease output
using Base.Iterators: take
for (rows, cols) in take(eachchunk(band), 3)
    @info &quot;window&quot; rows cols
end</code></pre><pre class="documenter-example-output">┌ Info: window
│   rows = CartesianIndex(1, 1)
└   cols = CartesianIndex(2, 1)
┌ Info: window
│   rows = CartesianIndex(257, 1)
└   cols = CartesianIndex(258, 1)
┌ Info: window
│   rows = CartesianIndex(513, 1)
└   cols = CartesianIndex(514, 1)</pre><p>This code is similar to the window function mentioned in <a href="#Windowed-Reads-and-Writes">Windowed Reads and Writes</a> but more portable because the raster band can be exchanged with any other type implementing the DiskArrays interface. Also, for many operations it will not be necessary anymore to implement the window loop, since the <code>DiskArrays</code> package provides efficient implementations for reductions and lazy broadcasting, so that for example operations like: </p><pre><code class="language-julia">sum(sqrt.(band), dims=1)</code></pre><pre class="documenter-example-output">1×1024 Array{Float64,2}:
 7094.48  7094.48  7094.48  7094.48  …  30197.9  30368.0  30295.8  29723.7</pre><p>will read the data block by block allocating only the amount of memory in the order of the size of a single raster block. See <a href="https://github.com/meggart/DiskArrays.jl/blob/master/README.md">the DiskArrays README</a> for more information on DiskArrays.jl</p><h2 id="The-RasterDataset-type"><a class="docs-heading-anchor" href="#The-RasterDataset-type">The RasterDataset type</a><a id="The-RasterDataset-type-1"></a><a class="docs-heading-anchor-permalink" href="#The-RasterDataset-type" title="Permalink"></a></h2><p>Many raster datasets that contain multiple bands of the same size and data type can also be abstracted as a 3D array where the last dimension represents the band index. In order to open a raster dataset in a way that it is represented as a 3D <code>AbstractArray</code> there is the <code>readraster</code> funtion. It returns a <code>RasterDataset</code> which is a thin wrapper around a <code>Dataset</code> but it is a subtype of <code>AbstractDiskArray{T,3}</code> and therefore part of the array hierarchy. </p><p>This means that data can be accessed with the square-bracket syntax</p><pre><code class="language-julia">dataset = AG.readraster(&quot;gdalworkshop/world.tif&quot;)
dataset[1000,300,:]</code></pre><pre class="documenter-example-output">3-element Array{UInt8,1}:
 0x87
 0x78
 0x41</pre><p>and broadcasting, views and reductions are provided by the DiskArrays package. In addition, many ArchGDAL functions like (<code>getband</code>, <code>nraster</code>, <code>getgeotransform</code>, etc) are delegated to the wrapped Dataset and work for RasterDatasets as well. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../features/">« Feature Data</a><a class="docs-footer-nextpage" href="../geometries/">Geometric Operations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 24 August 2020 22:04">Monday 24 August 2020</span>. Using Julia version 1.5.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
